{
  "version": 4,
  "terraform_version": "0.12.24",
  "serial": 200,
  "lineage": "9a953711-21d0-c456-de0a-75ef89ea8b73",
  "outputs": {},
  "resources": [
    {
      "mode": "data",
      "type": "archive_file",
      "name": "cloud_sniper_archive_threat_intelligence_automation",
      "provider": "provider.archive",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "excludes": null,
            "id": "cf26ecdcdd879d0ba60373039f6dc199be6d003b",
            "output_base64sha256": "4X16OBlWtEyiX2K0ECYsGT+la+yWVTmBLWXqd4NzUmA=",
            "output_md5": "22128d72efe7671803733e47538414bf",
            "output_path": "./lambdas/archives/cloud-sniper-threat-intelligence.zip",
            "output_sha": "cf26ecdcdd879d0ba60373039f6dc199be6d003b",
            "output_size": 556656,
            "source": [],
            "source_content": null,
            "source_content_filename": null,
            "source_dir": "./lambdas/python/cloud-sniper-threat-intelligence/",
            "source_file": null,
            "type": "zip"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_caller_identity",
      "name": "current",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "account_id": "343147215622",
            "arn": "arn:aws:iam::343147215622:user/nrivero",
            "id": "2020-07-06 05:09:04.135939 +0000 UTC",
            "user_id": "AIDAU7ZJK7MDON2JAPVJN"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "cloud_sniper_policy_document_assume_beaconing_detection",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "3693445097",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "lambda.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "cloud_sniper_policy_document_assume_spoke_threat_intelligence_automation",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "214187692",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::343147215622:role/cloud-sniper-assume-role-threat-intelligence-automation\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "arn:aws:iam::343147215622:role/cloud-sniper-assume-role-threat-intelligence-automation"
                    ],
                    "type": "AWS"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "cloud_sniper_policy_document_assume_threat_intelligence_automation",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "3693445097",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      }\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [
                  {
                    "identifiers": [
                      "lambda.amazonaws.com"
                    ],
                    "type": "Service"
                  }
                ],
                "resources": [],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "cloud_sniper_policy_document_beaconing_detection",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "1877986836",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListObjects\",\n        \"s3:ListBucket\"\n      ],\n      \"Resource\": \"arn:aws:s3:::cloud-sniper-data-store\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:PutObject\",\n        \"s3:GetObject\"\n      ],\n      \"Resource\": \"arn:aws:s3:::cloud-sniper-data-store/*\"\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "s3:ListBucket",
                  "s3:ListObjects"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:s3:::cloud-sniper-data-store"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "s3:GetObject",
                  "s3:PutObject"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:s3:::cloud-sniper-data-store/*"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "cloud_sniper_policy_document_spoke_threat_intelligence_automation",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "4024623947",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"iam:ListAccountAliases\",\n        \"ec2:Describe*\",\n        \"ec2:*NetworkAcl*\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "ec2:*NetworkAcl*",
                  "ec2:Describe*",
                  "iam:ListAccountAliases"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_iam_policy_document",
      "name": "cloud_sniper_policy_document_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "id": "2859925601",
            "json": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:Describe*\",\n        \"ec2:DeleteNetworkInterface\",\n        \"ec2:CreateNetworkInterface\",\n        \"ec2:*NetworkAcl*\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"logs:PutLogEvents\",\n        \"logs:CreateLogStream\",\n        \"logs:CreateLogGroup\"\n      ],\n      \"Resource\": \"arn:aws:logs:*:*:*\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"dynamodb:UpdateItem\",\n        \"dynamodb:Scan\",\n        \"dynamodb:Query\",\n        \"dynamodb:PutItem\",\n        \"dynamodb:GetItem\",\n        \"dynamodb:DeleteItem\"\n      ],\n      \"Resource\": \"arn:aws:dynamodb:us-west-2:343147215622:table/cloud-sniper-table-ioc\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sqs:*\",\n      \"Resource\": \"arn:aws:sqs:us-west-2:343147215622:cloud-sniper-sqs-queue-threat-intelligence-automation\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"iam:ListAccountAliases\",\n      \"Resource\": \"*\"\n    }\n  ]\n}",
            "override_json": null,
            "policy_id": null,
            "source_json": null,
            "statement": [
              {
                "actions": [
                  "ec2:*NetworkAcl*",
                  "ec2:CreateNetworkInterface",
                  "ec2:DeleteNetworkInterface",
                  "ec2:Describe*"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "logs:CreateLogGroup",
                  "logs:CreateLogStream",
                  "logs:PutLogEvents"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:logs:*:*:*"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "dynamodb:DeleteItem",
                  "dynamodb:GetItem",
                  "dynamodb:PutItem",
                  "dynamodb:Query",
                  "dynamodb:Scan",
                  "dynamodb:UpdateItem"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:dynamodb:us-west-2:343147215622:table/cloud-sniper-table-ioc"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "sqs:*"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "arn:aws:sqs:us-west-2:343147215622:cloud-sniper-sqs-queue-threat-intelligence-automation"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "sts:AssumeRole"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": ""
              },
              {
                "actions": [
                  "iam:ListAccountAliases"
                ],
                "condition": [],
                "effect": "Allow",
                "not_actions": [],
                "not_principals": [],
                "not_resources": [],
                "principals": [],
                "resources": [
                  "*"
                ],
                "sid": ""
              }
            ],
            "version": "2012-10-17"
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_region",
      "name": "current",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "current": null,
            "description": "US West (Oregon)",
            "endpoint": "ec2.us-west-2.amazonaws.com",
            "id": "us-west-2",
            "name": "us-west-2"
          }
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_event_rule",
      "name": "cloud_sniper_cloudwatch_event_rule_schedule_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:events:us-west-2:343147215622:rule/cloud-sniper-event-rule-schedule-threat-intelligence",
            "description": "cloud-sniper-event-rule-schedule-threat-intelligence",
            "event_pattern": null,
            "id": "cloud-sniper-event-rule-schedule-threat-intelligence",
            "is_enabled": true,
            "name": "cloud-sniper-event-rule-schedule-threat-intelligence",
            "name_prefix": null,
            "role_arn": "",
            "schedule_expression": "rate(5 minutes)",
            "tags": {
              "Department": "engineering",
              "Owner": "Cloud Sniper",
              "Purpose": "Incident and Response Automation",
              "TagVersion": "1.0"
            }
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_event_rule",
      "name": "cloud_sniper_cloudwatch_event_rule_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:events:us-west-2:343147215622:rule/cloud-sniper-event-rule-threat-intelligence",
            "description": "cloud-sniper-event-rule-threat-intelligence",
            "event_pattern": "{\"detail-type\":[\"GuardDuty Finding\"],\"source\":[\"aws.guardduty\"]}",
            "id": "cloud-sniper-event-rule-threat-intelligence",
            "is_enabled": true,
            "name": "cloud-sniper-event-rule-threat-intelligence",
            "name_prefix": null,
            "role_arn": "",
            "schedule_expression": "",
            "tags": {
              "Department": "engineering",
              "Owner": "Cloud Sniper",
              "Purpose": "Incident and Response Automation",
              "TagVersion": "1.0"
            }
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_event_target",
      "name": "cloud_sniper_cloudwatch_event_rule_schedule_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:lambda:us-west-2:343147215622:function:cloud-sniper-lambda-threat-intelligence-automation",
            "batch_target": [],
            "ecs_target": [],
            "id": "cloud-sniper-event-rule-schedule-threat-intelligence-terraform-20200706024733046800000004",
            "input": "",
            "input_path": "",
            "input_transformer": [],
            "kinesis_target": [],
            "role_arn": "",
            "rule": "cloud-sniper-event-rule-schedule-threat-intelligence",
            "run_command_targets": [],
            "sqs_target": [],
            "target_id": "terraform-20200706024733046800000004"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_cloudwatch_event_rule.cloud_sniper_cloudwatch_event_rule_schedule_threat_intelligence_automation",
            "aws_dynamodb_table.cloud_sniper_table_ioc",
            "aws_iam_role.cloud_sniper_role_threat_intelligence_automation",
            "aws_lambda_function.cloud_sniper_lambda_threat_intelligence_automation",
            "aws_security_group.cloud_sniper_security_group_https_egress",
            "aws_sqs_queue.cloud_sniper_sqs_queue_threat_intelligence_automation",
            "aws_subnet.cloud_sniper_private_subnet",
            "aws_vpc.cloud_sniper_vpc"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_event_target",
      "name": "cloud_sniper_cloudwatch_event_target_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:sqs:us-west-2:343147215622:cloud-sniper-sqs-queue-threat-intelligence-automation",
            "batch_target": [],
            "ecs_target": [],
            "id": "cloud-sniper-event-rule-threat-intelligence-terraform-20200706024529253300000002",
            "input": "",
            "input_path": "",
            "input_transformer": [],
            "kinesis_target": [],
            "role_arn": "",
            "rule": "cloud-sniper-event-rule-threat-intelligence",
            "run_command_targets": [],
            "sqs_target": [],
            "target_id": "terraform-20200706024529253300000002"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_cloudwatch_event_rule.cloud_sniper_cloudwatch_event_rule_threat_intelligence_automation",
            "aws_sqs_queue.cloud_sniper_sqs_queue_threat_intelligence_automation"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_cloudwatch_metric_alarm",
      "name": "cloud_sniper_cloudwatch_metric_alarm_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 1,
          "attributes": {
            "actions_enabled": true,
            "alarm_actions": [
              "arn:aws:sns:us-west-2:343147215622:cloud-sniper-sns-alarm"
            ],
            "alarm_description": "There was a potential Cloud Sniper threat intelligence automation issue, check Lambda logs",
            "alarm_name": "cloud-sniper-lambda-threat-intelligence-automation-errors",
            "arn": "arn:aws:cloudwatch:us-west-2:343147215622:alarm:cloud-sniper-lambda-threat-intelligence-automation-errors",
            "comparison_operator": "GreaterThanOrEqualToThreshold",
            "datapoints_to_alarm": 1,
            "dimensions": {
              "FunctionName": "cloud-sniper-lambda-threat-intelligence-automation"
            },
            "evaluate_low_sample_count_percentiles": "",
            "evaluation_periods": 1,
            "extended_statistic": "",
            "id": "cloud-sniper-lambda-threat-intelligence-automation-errors",
            "insufficient_data_actions": [],
            "metric_name": "Errors",
            "metric_query": [],
            "namespace": "AWS/Lambda",
            "ok_actions": [],
            "period": 300,
            "statistic": "Sum",
            "tags": {
              "Department": "engineering",
              "Owner": "Cloud Sniper",
              "Purpose": "Incident and Response Automation",
              "TagVersion": "1.0"
            },
            "threshold": 1,
            "threshold_metric_id": "",
            "treat_missing_data": "missing",
            "unit": ""
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_dynamodb_table.cloud_sniper_table_ioc",
            "aws_iam_role.cloud_sniper_role_threat_intelligence_automation",
            "aws_lambda_function.cloud_sniper_lambda_threat_intelligence_automation",
            "aws_sns_topic.cloud_sniper_sns_alarm",
            "aws_sqs_queue.cloud_sniper_sqs_queue_threat_intelligence_automation"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dynamodb_table",
      "name": "cloud_sniper_table_ioc",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:dynamodb:us-west-2:343147215622:table/cloud-sniper-table-ioc",
            "attribute": [
              {
                "name": "ip_attacker",
                "type": "S"
              },
              {
                "name": "timestamp",
                "type": "S"
              }
            ],
            "billing_mode": "PROVISIONED",
            "global_secondary_index": [],
            "hash_key": "ip_attacker",
            "id": "cloud-sniper-table-ioc",
            "local_secondary_index": [],
            "name": "cloud-sniper-table-ioc",
            "point_in_time_recovery": [
              {
                "enabled": false
              }
            ],
            "range_key": "timestamp",
            "read_capacity": 5,
            "replica": [],
            "server_side_encryption": [],
            "stream_arn": "",
            "stream_enabled": false,
            "stream_label": "",
            "stream_view_type": "",
            "tags": {},
            "timeouts": null,
            "ttl": [
              {
                "attribute_name": "",
                "enabled": false
              }
            ],
            "write_capacity": 5
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwLCJ1cGRhdGUiOjM2MDAwMDAwMDAwMDB9LCJzY2hlbWFfdmVyc2lvbiI6IjEifQ=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_policy",
      "name": "cloud_sniper_policy_beaconing_detection",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::343147215622:policy/cloud-sniper-policy-beaconing-detection",
            "description": "",
            "id": "arn:aws:iam::343147215622:policy/cloud-sniper-policy-beaconing-detection",
            "name": "cloud-sniper-policy-beaconing-detection",
            "name_prefix": null,
            "path": "/",
            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:ListObjects\",\n        \"s3:ListBucket\"\n      ],\n      \"Resource\": \"arn:aws:s3:::cloud-sniper-data-store\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:PutObject\",\n        \"s3:GetObject\"\n      ],\n      \"Resource\": \"arn:aws:s3:::cloud-sniper-data-store/*\"\n    }\n  ]\n}"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_s3_bucket.cloud_sniper_s3_bucket_data_store"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_policy",
      "name": "cloud_sniper_policy_spoke_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": []
    },
    {
      "mode": "managed",
      "type": "aws_iam_policy",
      "name": "cloud_sniper_policy_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::343147215622:policy/cloud-sniper-policy-threat-intelligence-automation",
            "description": "",
            "id": "arn:aws:iam::343147215622:policy/cloud-sniper-policy-threat-intelligence-automation",
            "name": "cloud-sniper-policy-threat-intelligence-automation",
            "name_prefix": null,
            "path": "/",
            "policy": "{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:Describe*\",\n        \"ec2:DeleteNetworkInterface\",\n        \"ec2:CreateNetworkInterface\",\n        \"ec2:*NetworkAcl*\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"logs:PutLogEvents\",\n        \"logs:CreateLogStream\",\n        \"logs:CreateLogGroup\"\n      ],\n      \"Resource\": \"arn:aws:logs:*:*:*\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"dynamodb:UpdateItem\",\n        \"dynamodb:Scan\",\n        \"dynamodb:Query\",\n        \"dynamodb:PutItem\",\n        \"dynamodb:GetItem\",\n        \"dynamodb:DeleteItem\"\n      ],\n      \"Resource\": \"arn:aws:dynamodb:us-west-2:343147215622:table/cloud-sniper-table-ioc\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sqs:*\",\n      \"Resource\": \"arn:aws:sqs:us-west-2:343147215622:cloud-sniper-sqs-queue-threat-intelligence-automation\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"iam:ListAccountAliases\",\n      \"Resource\": \"*\"\n    }\n  ]\n}"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_dynamodb_table.cloud_sniper_table_ioc",
            "aws_sqs_queue.cloud_sniper_sqs_queue_threat_intelligence_automation"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "cloud_sniper_role_beaconing_detection",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::343147215622:role/cloud-sniper-assume-role-beaconing-detection",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2020-07-06T02:45:26Z",
            "description": "",
            "force_detach_policies": false,
            "id": "cloud-sniper-assume-role-beaconing-detection",
            "max_session_duration": 3600,
            "name": "cloud-sniper-assume-role-beaconing-detection",
            "name_prefix": null,
            "path": "/",
            "permissions_boundary": null,
            "tags": {},
            "unique_id": "AROAU7ZJK7MDCZXOOOXVR"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "cloud_sniper_role_spoke_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": []
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "cloud_sniper_role_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::343147215622:role/cloud-sniper-assume-role-threat-intelligence-automation",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"lambda.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2020-07-06T02:45:26Z",
            "description": "",
            "force_detach_policies": false,
            "id": "cloud-sniper-assume-role-threat-intelligence-automation",
            "max_session_duration": 3600,
            "name": "cloud-sniper-assume-role-threat-intelligence-automation",
            "name_prefix": null,
            "path": "/",
            "permissions_boundary": null,
            "tags": {
              "Department": "engineering",
              "Owner": "Cloud Sniper",
              "Purpose": "Incident and Response Automation",
              "TagVersion": "1.0"
            },
            "unique_id": "AROAU7ZJK7MDBOK7AWN7T"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "cloud_sniper_role_policy_attachment_beaconing_detection",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "id": "cloud-sniper-assume-role-beaconing-detection-20200706024529140000000001",
            "policy_arn": "arn:aws:iam::343147215622:policy/cloud-sniper-policy-beaconing-detection",
            "role": "cloud-sniper-assume-role-beaconing-detection"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_policy.cloud_sniper_policy_beaconing_detection",
            "aws_iam_role.cloud_sniper_role_beaconing_detection"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "cloud_sniper_role_policy_attachment_spoke_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": []
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy_attachment",
      "name": "cloud_sniper_role_policy_attachment_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "id": "cloud-sniper-assume-role-threat-intelligence-automation-20200706024532927500000003",
            "policy_arn": "arn:aws:iam::343147215622:policy/cloud-sniper-policy-threat-intelligence-automation",
            "role": "cloud-sniper-assume-role-threat-intelligence-automation"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_policy.cloud_sniper_policy_threat_intelligence_automation",
            "aws_iam_role.cloud_sniper_role_threat_intelligence_automation",
            "aws_sqs_queue.cloud_sniper_sqs_queue_threat_intelligence_automation"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_lambda_function",
      "name": "cloud_sniper_lambda_beaconing_detection",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:lambda:us-west-2:343147215622:function:cloud-sniper-lambda-beaconing-detection",
            "dead_letter_config": [],
            "description": "Cloud Sniper beaconing detection",
            "environment": [
              {
                "variables": {
                  "BUCKET_NAME": "cloud-sniper-data-store",
                  "FINDINGS_PATH": "/beaconing-detection/findings",
                  "VPC_FLOW_LOGS_PATH": "/beaconing-detection/vpc-flow-logs"
                }
              }
            ],
            "filename": null,
            "function_name": "cloud-sniper-lambda-beaconing-detection",
            "handler": "cloud_sniper_beaconing_detection.cloud_sniper_beaconing_detection",
            "id": "cloud-sniper-lambda-beaconing-detection",
            "invoke_arn": "arn:aws:apigateway:us-west-2:lambda:path/2015-03-31/functions/arn:aws:lambda:us-west-2:343147215622:function:cloud-sniper-lambda-beaconing-detection/invocations",
            "kms_key_arn": "",
            "last_modified": "2020-07-06T05:00:12.336+0000",
            "layers": [],
            "memory_size": 1024,
            "publish": false,
            "qualified_arn": "arn:aws:lambda:us-west-2:343147215622:function:cloud-sniper-lambda-beaconing-detection:$LATEST",
            "reserved_concurrent_executions": -1,
            "role": "arn:aws:iam::343147215622:role/cloud-sniper-assume-role-beaconing-detection",
            "runtime": "python3.6",
            "s3_bucket": "cloud-sniper-data-store",
            "s3_key": "cloud_sniper_beaconing_detection.zip",
            "s3_object_version": null,
            "source_code_hash": "5Y6hgsJzTxrJz6CalB24DYMiS9w51rMdFaGChiKJiqI=",
            "source_code_size": 57193142,
            "tags": {},
            "timeout": 300,
            "timeouts": null,
            "tracing_config": [
              {
                "mode": "PassThrough"
              }
            ],
            "version": "$LATEST",
            "vpc_config": []
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "aws_iam_role.cloud_sniper_role_beaconing_detection",
            "aws_s3_bucket.cloud_sniper_s3_bucket_data_store"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_lambda_function",
      "name": "cloud_sniper_lambda_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:lambda:us-west-2:343147215622:function:cloud-sniper-lambda-threat-intelligence-automation",
            "dead_letter_config": [],
            "description": "Cloud Sniper threat intelligence automation",
            "environment": [
              {
                "variables": {
                  "DYNAMO_TABLE_CLOUD_SNIPER": "cloud-sniper-table-ioc",
                  "HUB_ACCOUNT_ID_CLOUD_SNIPER": "343147215622",
                  "ROLE_SPOKE_CLOUD_SNIPER": "cloud-sniper-role-spoke-threat-intelligence-automation",
                  "SQS_QUEUE_CLOUD_SNIPER": "https://sqs.us-west-2.amazonaws.com/343147215622/cloud-sniper-sqs-queue-threat-intelligence-automation",
                  "WEBHOOK_URL_IR": "https://hooks.slack.com/services/[your-id]"
                }
              }
            ],
            "filename": "./lambdas/archives/cloud-sniper-threat-intelligence.zip",
            "function_name": "cloud-sniper-lambda-threat-intelligence-automation",
            "handler": "cloud_sniper_threat_intelligence.security_ir",
            "id": "cloud-sniper-lambda-threat-intelligence-automation",
            "invoke_arn": "arn:aws:apigateway:us-west-2:lambda:path/2015-03-31/functions/arn:aws:lambda:us-west-2:343147215622:function:cloud-sniper-lambda-threat-intelligence-automation/invocations",
            "kms_key_arn": "",
            "last_modified": "2020-07-06T05:09:37.203+0000",
            "layers": [],
            "memory_size": 1024,
            "publish": false,
            "qualified_arn": "arn:aws:lambda:us-west-2:343147215622:function:cloud-sniper-lambda-threat-intelligence-automation:$LATEST",
            "reserved_concurrent_executions": -1,
            "role": "arn:aws:iam::343147215622:role/cloud-sniper-assume-role-threat-intelligence-automation",
            "runtime": "python3.6",
            "s3_bucket": null,
            "s3_key": null,
            "s3_object_version": null,
            "source_code_hash": "4X16OBlWtEyiX2K0ECYsGT+la+yWVTmBLWXqd4NzUmA=",
            "source_code_size": 556656,
            "tags": {
              "Department": "engineering",
              "Owner": "Cloud Sniper",
              "Purpose": "Incident and Response Automation",
              "TagVersion": "1.0"
            },
            "timeout": 300,
            "timeouts": null,
            "tracing_config": [
              {
                "mode": "PassThrough"
              }
            ],
            "version": "$LATEST",
            "vpc_config": []
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDB9fQ==",
          "dependencies": [
            "aws_dynamodb_table.cloud_sniper_table_ioc",
            "aws_iam_role.cloud_sniper_role_threat_intelligence_automation",
            "aws_sqs_queue.cloud_sniper_sqs_queue_threat_intelligence_automation"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_s3_bucket",
      "name": "cloud_sniper_s3_bucket_data_store",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "acceleration_status": "",
            "acl": "private",
            "arn": "arn:aws:s3:::cloud-sniper-data-store",
            "bucket": "cloud-sniper-data-store",
            "bucket_domain_name": "cloud-sniper-data-store.s3.amazonaws.com",
            "bucket_prefix": null,
            "bucket_regional_domain_name": "cloud-sniper-data-store.s3.us-west-2.amazonaws.com",
            "cors_rule": [],
            "force_destroy": false,
            "grant": [],
            "hosted_zone_id": "Z3BJ6K6RIION7M",
            "id": "cloud-sniper-data-store",
            "lifecycle_rule": [],
            "logging": [],
            "object_lock_configuration": [],
            "policy": null,
            "region": "us-west-2",
            "replication_configuration": [],
            "request_payer": "BucketOwner",
            "server_side_encryption_configuration": [],
            "tags": {},
            "versioning": [
              {
                "enabled": false,
                "mfa_delete": false
              }
            ],
            "website": [],
            "website_domain": null,
            "website_endpoint": null
          }
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_sns_topic",
      "name": "cloud_sniper_sns_alarm",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "application_failure_feedback_role_arn": "",
            "application_success_feedback_role_arn": "",
            "application_success_feedback_sample_rate": 0,
            "arn": "arn:aws:sns:us-west-2:343147215622:cloud-sniper-sns-alarm",
            "delivery_policy": "",
            "display_name": "",
            "http_failure_feedback_role_arn": "",
            "http_success_feedback_role_arn": "",
            "http_success_feedback_sample_rate": 0,
            "id": "arn:aws:sns:us-west-2:343147215622:cloud-sniper-sns-alarm",
            "kms_master_key_id": "",
            "lambda_failure_feedback_role_arn": "",
            "lambda_success_feedback_role_arn": "",
            "lambda_success_feedback_sample_rate": 0,
            "name": "cloud-sniper-sns-alarm",
            "name_prefix": null,
            "policy": "{\"Version\":\"2008-10-17\",\"Id\":\"__default_policy_ID\",\"Statement\":[{\"Sid\":\"__default_statement_ID\",\"Effect\":\"Allow\",\"Principal\":{\"AWS\":\"*\"},\"Action\":[\"SNS:GetTopicAttributes\",\"SNS:SetTopicAttributes\",\"SNS:AddPermission\",\"SNS:RemovePermission\",\"SNS:DeleteTopic\",\"SNS:Subscribe\",\"SNS:ListSubscriptionsByTopic\",\"SNS:Publish\",\"SNS:Receive\"],\"Resource\":\"arn:aws:sns:us-west-2:343147215622:cloud-sniper-sns-alarm\",\"Condition\":{\"StringEquals\":{\"AWS:SourceOwner\":\"343147215622\"}}}]}",
            "sqs_failure_feedback_role_arn": "",
            "sqs_success_feedback_role_arn": "",
            "sqs_success_feedback_sample_rate": 0,
            "tags": {}
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_sqs_queue",
      "name": "cloud_sniper_sqs_queue_threat_intelligence_automation",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:sqs:us-west-2:343147215622:cloud-sniper-sqs-queue-threat-intelligence-automation",
            "content_based_deduplication": false,
            "delay_seconds": 0,
            "fifo_queue": false,
            "id": "https://sqs.us-west-2.amazonaws.com/343147215622/cloud-sniper-sqs-queue-threat-intelligence-automation",
            "kms_data_key_reuse_period_seconds": 300,
            "kms_master_key_id": "",
            "max_message_size": 262144,
            "message_retention_seconds": 345600,
            "name": "cloud-sniper-sqs-queue-threat-intelligence-automation",
            "name_prefix": null,
            "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Principal\":\"*\",\"Action\":\"sqs:SendMessage\",\"Resource\":\"arn:aws:sqs:us-west-2:343147215622:cloud-sniper-sqs-queue-threat-intelligence-automation\",\"Condition\":{\"ArnEquals\":{\"aws:SourceArn\":\"arn:aws:events:us-west-2:343147215622:rule/cloud-sniper-event-rule-threat-intelligence\"}}}]}",
            "receive_wait_time_seconds": 0,
            "redrive_policy": "",
            "tags": {
              "Department": "engineering",
              "Owner": "Cloud Sniper",
              "Purpose": "Incident and Response Automation",
              "TagVersion": "1.0"
            },
            "visibility_timeout_seconds": 30
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_sqs_queue_policy",
      "name": "cloud_sniper_sqs_queue_policy_security_ir",
      "each": "map",
      "provider": "provider.aws",
      "instances": [
        {
          "index_key": "hub",
          "schema_version": 1,
          "attributes": {
            "id": "https://sqs.us-west-2.amazonaws.com/343147215622/cloud-sniper-sqs-queue-threat-intelligence-automation",
            "policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Principal\":\"*\",\"Action\":\"sqs:SendMessage\",\"Resource\":\"arn:aws:sqs:us-west-2:343147215622:cloud-sniper-sqs-queue-threat-intelligence-automation\",\"Condition\":{\"ArnEquals\":{\"aws:SourceArn\":\"arn:aws:events:us-west-2:343147215622:rule/cloud-sniper-event-rule-threat-intelligence\"}}}]}",
            "queue_url": "https://sqs.us-west-2.amazonaws.com/343147215622/cloud-sniper-sqs-queue-threat-intelligence-automation"
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==",
          "dependencies": [
            "aws_cloudwatch_event_rule.cloud_sniper_cloudwatch_event_rule_threat_intelligence_automation",
            "aws_sqs_queue.cloud_sniper_sqs_queue_threat_intelligence_automation"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_subnet",
      "name": "cloud_sniper_private_subnet",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-west-2:343147215622:subnet/subnet-083e96cb91051009e",
            "assign_ipv6_address_on_creation": false,
            "availability_zone": "us-west-2a",
            "availability_zone_id": "usw2-az1",
            "cidr_block": "10.0.0.0/24",
            "id": "subnet-083e96cb91051009e",
            "ipv6_cidr_block": "",
            "ipv6_cidr_block_association_id": "",
            "map_public_ip_on_launch": false,
            "outpost_arn": "",
            "owner_id": "343147215622",
            "tags": {
              "Department": "engineering",
              "Owner": "Cloud Sniper",
              "Purpose": "Incident and Response Automation",
              "TagVersion": "1.0"
            },
            "timeouts": null,
            "vpc_id": "vpc-09d966a78178a72e4"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "aws_vpc.cloud_sniper_vpc"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_vpc",
      "name": "cloud_sniper_vpc",
      "provider": "provider.aws",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:us-west-2:343147215622:vpc/vpc-09d966a78178a72e4",
            "assign_generated_ipv6_cidr_block": false,
            "cidr_block": "10.0.0.0/16",
            "default_network_acl_id": "acl-024ef47369c0d6555",
            "default_route_table_id": "rtb-0bd508bbd796d2f3b",
            "default_security_group_id": "sg-00630b221440486e2",
            "dhcp_options_id": "dopt-06eeef6441e4a7591",
            "enable_classiclink": false,
            "enable_classiclink_dns_support": false,
            "enable_dns_hostnames": true,
            "enable_dns_support": true,
            "id": "vpc-09d966a78178a72e4",
            "instance_tenancy": "default",
            "ipv6_association_id": "",
            "ipv6_cidr_block": "",
            "main_route_table_id": "rtb-0bd508bbd796d2f3b",
            "owner_id": "343147215622",
            "tags": {
              "Department": "engineering",
              "Owner": "Cloud Sniper",
              "Purpose": "Incident and Response Automation",
              "TagVersion": "1.0"
            }
          },
          "private": "eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ=="
        }
      ]
    }
  ]
}
